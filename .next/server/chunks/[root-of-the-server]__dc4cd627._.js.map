{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 146, "column": 0}, "map": {"version":3,"sources":["file:///Users/vinim/giropro-motoristas/src/app/api/generate-insight/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport OpenAI from 'openai';\n\n// 1. Fun√ß√£o para buscar o Clima (OpenWeather)\nasync function getClima(cidade: string) {\n  const apiKey = process.env.OPENWEATHER_API_KEY;\n  if (!apiKey || !cidade) return null;\n\n  try {\n    // Busca latitude/longitude (Geocoding)\n    const geoRes = await fetch(\n      `http://api.openweathermap.org/geo/1.0/direct?q=${cidade},BR&limit=1&appid=${apiKey}`\n    );\n    const geoData = await geoRes.json();\n\n    if (!geoData.length) return null;\n\n    const { lat, lon } = geoData[0];\n\n    // Busca clima atual\n    const weatherRes = await fetch(\n      `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&lang=pt_br&appid=${apiKey}`\n    );\n    const weatherData = await weatherRes.json();\n\n    const clima = weatherData.weather[0];\n    const temp = Math.round(weatherData.main.temp);\n    \n    // Detecta chuva para alertar sobre tarifa din√¢mica\n    const ehChuva = ['Rain', 'Drizzle', 'Thunderstorm'].includes(clima.main);\n\n    return {\n      resumo: `${clima.description}, ${temp}¬∞C`,\n      ehChuva,\n      temp\n    };\n  } catch (error) {\n    console.error(\"Erro clima:\", error);\n    return null;\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { prompt, cidade } = body;\n\n    // 2. Prepara o Contexto do Clima\n    let contextoClima = \"\";\n    const cidadeAlvo = cidade || \"S√£o Paulo\"; // Padr√£o caso n√£o venha do front\n\n    const dadosClima = await getClima(cidadeAlvo);\n\n    if (dadosClima) {\n      contextoClima = `\n      CONTEXTO TEMPO REAL (${cidadeAlvo}):\n      - Clima: ${dadosClima.resumo}\n      ${dadosClima.ehChuva ? \"‚ö†Ô∏è ALERTA: Est√° chovendo! Avise que a demanda/din√¢mica vai subir e pe√ßa cuidado.\" : \"‚úÖ Tempo firme.\"}\n      `;\n    }\n\n    // 3. Define o Sistema da IA\n    const sistemaPrompt = `Voc√™ √© o \"GiroPro Coach\", um especialista financeiro para motoristas de aplicativo no Brasil.\n    Seu tom √© parceiro, motivador e direto (g√≠rias leves permitidas).\n    Use emojis.\n    ${contextoClima}\n    `;\n\n    // 4. Conecta na GROQ (Substituindo OpenAI)\n    if (process.env.GROQ_API_KEY) {\n      const groq = new OpenAI({\n        apiKey: process.env.GROQ_API_KEY,\n        baseURL: \"https://api.groq.com/openai/v1\", // Endpoint da Groq\n      });\n\n      const completion = await groq.chat.completions.create({\n        model: \"llama-3.3-70b-versatile\", // Modelo r√°pido e inteligente da Meta\n        messages: [\n          { role: \"system\", content: sistemaPrompt },\n          { role: \"user\", content: prompt || \"Me d√™ uma dica r√°pida sobre meu desempenho hoje.\" }\n        ],\n        temperature: 0.7,\n        max_tokens: 400,\n      });\n\n      return NextResponse.json({ insight: completion.choices[0].message.content });\n    }\n\n    // 5. Fallback (Se n√£o tiver chave configurada)\n    // Mostra dados de clima reais mesmo sem IA\n    if (dadosClima && dadosClima.ehChuva) {\n      return NextResponse.json({\n        insight: `üåßÔ∏è Aten√ß√£o em ${cidadeAlvo}!\n        \nEst√° chovendo agora (${dadosClima.resumo}). A tarifa din√¢mica deve subir nas pr√≥ximas horas. \nSe estiver seguro, v√° para √°reas de alta demanda (Shoppings/Escrit√≥rios).\n        \n(Configure sua chave Groq para ter insights completos)`\n      });\n    }\n\n    return NextResponse.json({\n      insight: \"üöÄ Giro registrado! Para an√°lises personalizadas, configure a API da Groq no projeto.\"\n    });\n\n  } catch (error: any) {\n    console.error(\"Erro API:\", error);\n    return NextResponse.json(\n      { insight: \"O sistema de insights est√° indispon√≠vel no momento. Tente mais tarde.\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEA,8CAA8C;AAC9C,eAAe,SAAS,MAAc;IACpC,MAAM,SAAS,QAAQ,GAAG,CAAC,mBAAmB;IAC9C,IAAI,CAAC,UAAU,CAAC,QAAQ,OAAO;IAE/B,IAAI;QACF,uCAAuC;QACvC,MAAM,SAAS,MAAM,MACnB,CAAC,+CAA+C,EAAE,OAAO,kBAAkB,EAAE,QAAQ;QAEvF,MAAM,UAAU,MAAM,OAAO,IAAI;QAEjC,IAAI,CAAC,QAAQ,MAAM,EAAE,OAAO;QAE5B,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,OAAO,CAAC,EAAE;QAE/B,oBAAoB;QACpB,MAAM,aAAa,MAAM,MACvB,CAAC,oDAAoD,EAAE,IAAI,KAAK,EAAE,IAAI,+BAA+B,EAAE,QAAQ;QAEjH,MAAM,cAAc,MAAM,WAAW,IAAI;QAEzC,MAAM,QAAQ,YAAY,OAAO,CAAC,EAAE;QACpC,MAAM,OAAO,KAAK,KAAK,CAAC,YAAY,IAAI,CAAC,IAAI;QAE7C,mDAAmD;QACnD,MAAM,UAAU;YAAC;YAAQ;YAAW;SAAe,CAAC,QAAQ,CAAC,MAAM,IAAI;QAEvE,OAAO;YACL,QAAQ,GAAG,MAAM,WAAW,CAAC,EAAE,EAAE,KAAK,EAAE,CAAC;YACzC;YACA;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO;IACT;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG;QAE3B,iCAAiC;QACjC,IAAI,gBAAgB;QACpB,MAAM,aAAa,UAAU,aAAa,iCAAiC;QAE3E,MAAM,aAAa,MAAM,SAAS;QAElC,IAAI,YAAY;YACd,gBAAgB,CAAC;2BACI,EAAE,WAAW;eACzB,EAAE,WAAW,MAAM,CAAC;MAC7B,EAAE,WAAW,OAAO,GAAG,qFAAqF,iBAAiB;MAC7H,CAAC;QACH;QAEA,4BAA4B;QAC5B,MAAM,gBAAgB,CAAC;;;IAGvB,EAAE,cAAc;IAChB,CAAC;QAED,2CAA2C;QAC3C,IAAI,QAAQ,GAAG,CAAC,YAAY,EAAE;YAC5B,MAAM,OAAO,IAAI,kJAAA,CAAA,UAAM,CAAC;gBACtB,QAAQ,QAAQ,GAAG,CAAC,YAAY;gBAChC,SAAS;YACX;YAEA,MAAM,aAAa,MAAM,KAAK,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;gBACpD,OAAO;gBACP,UAAU;oBACR;wBAAE,MAAM;wBAAU,SAAS;oBAAc;oBACzC;wBAAE,MAAM;wBAAQ,SAAS,UAAU;oBAAmD;iBACvF;gBACD,aAAa;gBACb,YAAY;YACd;YAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,SAAS,WAAW,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;YAAC;QAC5E;QAEA,+CAA+C;QAC/C,2CAA2C;QAC3C,IAAI,cAAc,WAAW,OAAO,EAAE;YACpC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACvB,SAAS,CAAC,eAAe,EAAE,WAAW;;qBAEzB,EAAE,WAAW,MAAM,CAAC;;;sDAGa,CAAC;YACjD;QACF;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;QACX;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,aAAa;QAC3B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,SAAS;QAAwE,GACnF;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}